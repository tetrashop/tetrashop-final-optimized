<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ÛŒÛŒ</title>
    <style>
        body { font-family: Tahoma; margin: 20px; }
        button { 
            background: green; color: white; 
            padding: 15px 25px; margin: 10px; 
            border: none; border-radius: 8px; 
            cursor: pointer; font-size: 16px;
        }
        .status { padding: 15px; margin: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ¯ ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ÛŒÛŒ</h1>
    
    <div>
        <button onclick="testConnection()">ğŸ”— ØªØ³Øª Ø§ØªØµØ§Ù„</button>
        <button onclick="makeSale()">ğŸ’° ØªØ³Øª ÙØ±ÙˆØ´</button>
    </div>
    
    <div id="status" class="status">ÙˆØ¶Ø¹ÛŒØª: Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...</div>
    
    <div>
        <h3>ğŸ“Š Ø¢Ù…Ø§Ø± Ø²Ù†Ø¯Ù‡:</h3>
        <p>Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„: <span id="money">0</span> ØªÙˆÙ…Ø§Ù†</p>
        <p>ØªØ¹Ø¯Ø§Ø¯ ÙØ±ÙˆØ´: <span id="sales">0</span> Ù…ÙˆØ±Ø¯</p>
    </div>

    <script>
        async function testConnection() {
            const status = document.getElementById('status');
            try {
                status.innerHTML = 'ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...';
                const response = await fetch('http://localhost:3000/api/stats');
                const data = await response.json();
                
                status.className = 'status success';
                status.innerHTML = 'âœ… Ø³ÛŒØ³ØªÙ… Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ÛŒÛŒ Ù…ØªØµÙ„ Ø§Ø³Øª!';
                
                document.getElementById('money').textContent = data.totalRevenue.toLocaleString();
                document.getElementById('sales').textContent = data.totalSales;
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: ' + error.message;
            }
        }

        async function makeSale() {
            const status = document.getElementById('status');
            try {
                status.innerHTML = 'ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª ÙØ±ÙˆØ´...';
                const response = await fetch('http://localhost:3000/api/sell', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ test: true })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    status.className = 'status success';
                    status.innerHTML = 'âœ… ÙØ±ÙˆØ´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!';
                    alert('ğŸ‰ ÙØ±ÙˆØ´ Ù…ÙˆÙÙ‚!\nğŸ’° Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„: ' + data.total.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†');
                    testConnection(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
                }
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = 'âŒ Ø®Ø·Ø§ Ø¯Ø± ÙØ±ÙˆØ´: ' + error.message;
            }
        }

        // ØªØ³Øª Ø§ÙˆÙ„ÛŒÙ‡
        testConnection();
    </script>
</body>
</html>
