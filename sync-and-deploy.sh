#!/bin/bash
echo "๐ ุดุฑูุน ูุฑุขูุฏ ููฺฏุงูโุณุงุฒ ู ุงุณุชูุฑุงุฑ ุฎูุฏฺฉุงุฑ..."

# ุชุงุฑุฎ ู ุฒูุงู ุดุฑูุน
start_time=$(date)

# ุชุบุฑ ุจู ุฏุงุฑฺฉุชูุฑ ูพุฑูฺู
cd ~/tetrashop-final-optimized

# ุจุฑุฑุณ ุชุบุฑุงุช
if git diff-index --quiet HEAD --; then
    echo "๐ ูฺ ุชุบุฑ ุฌุฏุฏ ูุฌูุฏ ูุฏุงุฑุฏ."
    exit 0
fi

# ุงุถุงูู ฺฉุฑุฏู ุชุบุฑุงุช
echo "๐ ุงุถุงูู ฺฉุฑุฏู ุชุบุฑุงุช..."
git add .

# ุงุฌุงุฏ ฺฉุงูุช
commit_message="๐ ููฺฏุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ - $(date '+%Y-%m-%d %H:%M:%S')"
git commit -m "$commit_message"

# ููฺฏุงูโุณุงุฒ ุจุง ุณุฑูุฑ
echo "๐ ููฺฏุงูโุณุงุฒ ุจุง ุฑูพุงุฒุชูุฑ ุงุตู..."
git pull --rebase
git push

if [ $? -eq 0 ]; then
    echo "โ ููฺฏุงูโุณุงุฒ ุจุง ููููุช ุงูุฌุงู ุดุฏ"
    
    # ุจุฑุฑุณ ุงุณุชูุฑุงุฑ
    echo "๐ ุจุฑุฑุณ ุงุณุชูุฑุงุฑ..."
    sleep 10
    curl -s https://003fbb3e.tetrashop-final-optimized.pages.dev > /dev/null && \
        echo "โ ุงุณุชูุฑุงุฑ Cloudflare ููููุชโุขูุฒ ุจูุฏ" || \
        echo "โ๏ธ  ุงุณุชูุฑุงุฑ ุฏุฑ ุญุงู ูพุฑุฏุงุฒุด..."
    
    # ูุงฺฏ ฺฉุฑุฏู
    echo "๐ ููฺฏุงูโุณุงุฒ ุชฺฉูู ุดุฏู ุฏุฑ: $start_time" >> sync-log.txt
else
    echo "โ ุฎุทุง ุฏุฑ ููฺฏุงูโุณุงุฒ"
    exit 1
fi
